<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="MobileOptimized" content="640" />
    <meta name="HandheldFriendly" content="true" />
    <title>Xash - Fullscreen</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            color: #f0b418;
            font-family: Arial, sans-serif;
            touch-action: none; /* better mobile touch handling */
        }

        .emscripten_border {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background: #111;
        }

        canvas.emscripten {
            position: absolute;
            inset: 0;
            width: 100% !important;
            height: 100% !important;
            display: block;
            background-image: url(xd.png);
            background-size: cover;
            background-position: center;
            box-shadow: none;
            image-rendering: crisp-edges; /* optional: sharper pixels */
        }

        /* Loading / UI elements */
        #status {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-size: 1.2rem;
            color: #ffa600;
            text-shadow: 0 0 6px #000;
        }

        #progress1 {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            max-width: 500px;
            height: 24px;
            border: 2px solid #f0b418;
            background: #222;
            z-index: 100;
            border-radius: 4px;
            overflow: hidden;
        }

        #progress {
            height: 100%;
            width: 0%;
            background: #f0b418;
            transition: width 0.2s;
            color: #000;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #output {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 180px;
            background: rgba(0,0,0,0.85);
            color: #0f0;
            font-family: 'Lucida Console', monospace;
            padding: 10px;
            overflow-y: auto;
            z-index: 90;
            display: none;
            border-top: 2px solid #f0b418;
        }

        #controls, #optionsTitle, #fSettings {
            display: none;
        }

        /* Show console when checkbox is checked */
        #show_console_log:checked ~ #output {
            display: block;
        }

        .glow {
            color: #f0b418;
            text-decoration: none;
            transition: color 0.3s;
        }
        .glow:hover {
            color: #ffa600;
            text-shadow: 0 0 10px #ffa600;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ffa600;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body bgcolor="#000" text="#F0B418" oncontextmenu="event.preventDefault()">

    <div class="emscripten_border">
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    </div>

    <div id="status">Downloading...</div>
    <div id="progress1" style="display:none;">
        <div id="progress">0%</div>
    </div>

    <textarea id="output" rows="8"></textarea>

    <!-- Hidden launch options (shown only before game starts) -->
    <div hidden>
        <center>
            <a class="glow"><h1>Xash</h1></a>
        </center>
        <form id="fSettings">
            <!-- ... original form content remains here if you still want the menu ... -->
            <!-- For full auto-start you can remove or keep hidden -->
        </form>
    </div>

    <script>
        // Prevent default context menu and some shortcuts
        document.addEventListener('contextmenu', e => e.preventDefault());
        window.onbeforeunload = function(e) {
            e.preventDefault();
            e.returnValue = 'Really want to quit the game?';
        };

        // Optional: auto fullscreen when game is ready
        function tryFullscreen() {
            if (document.fullscreenElement) return;
            document.documentElement.requestFullscreen().catch(() => {});
        }
    </script>

    <script type="text/javascript" src="browserfs.min.js"></script>
    <script type="text/javascript">
        var zipMods = [];
        var pkgMods = [];
    </script>

    <script type="text/javascript" src="mods.js"></script>

    <script type="text/javascript">
        // ────────────────────────────────────────────────
        // Most of your original logic remains here
        // Only major changes are in CSS + canvas sizing
        // ────────────────────────────────────────────────

        var statusElement   = document.getElementById('status');
        var progressElement = document.getElementById('progress');
        var output          = document.getElementById('output');

        var Module = {
            canvas: document.getElementById('canvas'),
            setStatus: function(text) {
                statusElement.innerHTML = text;
                if (text.includes('%')) {
                    document.getElementById('progress1').style.display = 'block';
                    var m = text.match(/\((\d+(\.\d+)?)\/(\d+)\)/);
                    if (m) {
                        var perc = Math.round((parseFloat(m[1]) / parseFloat(m[3])) * 100);
                        progressElement.style.width = perc + '%';
                        progressElement.innerHTML = perc + '%';
                    }
                }
            },
            print: function(text) {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                if (text) {
                    output.value += text + '\n';
                    output.scrollTop = output.scrollHeight;
                }
            },
            printErr: function(text) {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                output.value += '[ERR] ' + text + '\n';
                output.scrollTop = output.scrollHeight;
            }
        };

        // Your remaining original script logic goes here...
        // (skipRun, startXash, fetchZIP, mountZIP, setupFS, etc.)

        // Example: auto fullscreen when game starts
        // Add this inside your game-start logic or after "shader success"
        // Module.canvas.addEventListener('click', tryFullscreen);

        // Show console toggle
        document.getElementById('show_console_log')?.addEventListener('change', function() {
            output.style.display = this.checked ? 'block' : 'none';
        });
    </script>

    <!-- Your original module loading scripts -->
    <script type="text/javascript" src="xash.js"></script>

</body>
</html>
