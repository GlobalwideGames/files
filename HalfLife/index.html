<!DOCTYPE html>

<!-- Ultimate Game Stash file--> 
<!-- For the regularly updating doc go to https://docs.google.com/document/d/1_FmH3BlSBQI7FGgAQL59-ZPe8eCxs35wel6JUyVaG8Q/ --> 

<html lang="en-us">
<base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@354e3c6939a08e472482653567d566ba3a2aa527/half%20life/">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="MobileOptimized" content="640" />
    <meta name="HandheldFriendly" content="true" />
    <title>Xash</title>

    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        window.onbeforeunload = function(e) {
            e.preventDefault();
            e.returnValue = 'Really want to quit the game?';
        };

        document.onkeydown = function(e) {
            e = e || window.event;

            if (!e.ctrlKey) return;

            var code = e.which || e.keyCode;

            switch (code) {
                case 83:
                case 87:
                    e.preventDefault();
                    e.stopPropagation();
                    break;
            }
        };

        var a = new Audio('music.mp3');
        var pashalka_count = 0;

        function play_sound() {
            if (pashalka_count == 40) a.play();
            if (pashalka_count < 100) pashalka_count += 1;
        }
        window.addEventListener('click', play_sound);
        window.addEventListener('keydown', play_sound);
    </script>

    <style>
        /* ────────────────────────────────────────────────────────────────
           FULL-SCREEN STYLING
        ──────────────────────────────────────────────────────────────── */
        html, body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: #555555;
            color: #f0b418;
            font-family: Arial, sans-serif;
            position: relative;
        }

        .emscripten {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        div.emscripten, .emscripten_border {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            position: absolute;
            top: 0;
            left: 0;
        }

        canvas.emscripten {
            border: 0;
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
            max-height: 100%;
            display: block;
            background-image: url(xash.png);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: #ffa600 0px 0px 9px 4px;
            image-rendering: pixelated; /* optional: better for retro games */
        }

        /* Overlay elements */
        #status, #progress1, #output, #controls, #optionsTitle, #fSettings {
            position: absolute;
            z-index: 10;
            pointer-events: auto;
        }

        #status {
            top: 10px;
            left: 10px;
        }

        #progress1 {
            top: 40px;
            left: 10px;
            width: 300px;
        }

        #output {
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            margin: 0;
            background: rgba(0,0,0,0.75);
            color: #0f0;
            font-family: 'Lucida Console', Monaco, monospace;
            border: none;
            outline: none;
            resize: none;
        }

        /* Original styling kept and adjusted */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #ffa600;
            width: 16px;
            height: 16px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        a.glow, a.glow:hover, a.glow:focus {
            text-decoration: none;
            color: #F0B418;
            transition: 500ms linear 0s;
            cursor: default;
        }

        a.glow:hover, a.glow:focus {
            color: #ffa600;
            text-shadow: -1px 1px 8px #ffa600, 1px -1px 8px #ffa600;
        }

        hr {
            border-color: #ffa600;
        }

        input[type="text"] {
            color: #f0b418;
            background-color: #555555;
            border: 2px solid #f0b418;
            font-family: Segoe UI;
            font-size: 15px;
            transition: 0.5s all;
        }

        * {
            cursor: default;
            user-select: none;
            outline: none;
        }

        #controls {
            display: inline-block;
            float: right;
            vertical-align: top;
            margin-top: 5px;
            margin-right: 20px;
        }
    </style>
</head>

<body bgcolor=#555555 text=#F0B418 link=#ffa600 vlink=#ffa600>

    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>

    <div style="width:100%;height:0px;position:absolute;top:0;left:0;">
        <div id="status">Downloading...</div>
        <div id="progress1" style="display:none;">
            <div id="progress" style="width:0%;"></div>
        </div>
    </div>

    <textarea id="output" rows="8" style="display:none;"></textarea>
    <div id="asyncDialog" style="display:none;"></div>

    <div hidden>
        <center>
            <a class="glow">
                <div id="optionsTitle">
                    <h1>Xash</h1>
                </div>
            </a>
        </center>

        <center>
            <form style="display:none" id="fSettings">
                <a class='glow'>Select filesystem for save and restore:</a><br>
                <div id="idbHider" style="display:none">
                    <label><input name="a" type="radio" id="rIndexedDB" checked />IndexedDB</label><br>
                </div>
                <label><input name="a" type="radio" id="rLocalStorage" />in Local storage</label><br>
                <label><input name="a" type="radio" id="rNone" />in RAM</label><br><br>
                <hr>

                <div id="zipHider" style="display:none">
                    <label><input name="b" type="radio" id="rZip" checked />ZIP archive from server</label>
                    <select id="selectZip" style="display:none"></select><br>
                </div>

                <label><input name="b" type="radio" id="rLocalZip" />Local ZIP file:</label>
                <label id="label_file_select"><input type="file" name="c" id="iZipFile" /><a class='glow'> Select ZIP file </a></label><br><br>
                <hr>

                Command-line arguments: 
                <input name="d" type="text" id="iArgs" value="-dev 1 -game valve" /><br><br>

                <a class='glow' onclick="startXash();return false;">Launch Xash!</a>
                <br><hr>

                <div id='linksPlaceholder' style="display:none">Download archives to load locally next time:</div><br>

                <div id="pkgHider" style="display:none">
                    <label><input name="b" type="radio" id="rPackage" />Package</label>
                    <select id="selectPkg" style="display:none"></select><br>
                </div>

                <div style="visibility: hidden;" class="loader" id="loader1"></div>
            </form>
        </center>

        <div style="width:100%">
            <span id="controls">
                <a style="visibility: hidden;" class="glow">
                    <span><label id="label_show_console_log" style="display: none;">
                        <input type="checkbox" id="show_console_log">Show Console Log
                    </label></span>
                </a>
                <a style="visibility: hidden;" class="glow">
                    <span><label><input type="checkbox" id="resize">Resize canvas</label></span>
                </a>
                <a style="visibility: hidden;" class="glow">
                    <span><label><input type="checkbox" id="pointerLock" checked>Lock/hide mouse pointer &nbsp;&nbsp;&nbsp;</label></span>
                </a>
                <span style="visibility: hidden;">
                    <input type="button" value="Fullscreen" onclick="Module.requestFullscreen(document.getElementById('pointerLock').checked, document.getElementById('resize').checked)">
                </span>
            </span>
        </div>
    </div>

    <script type="text/javascript" src="browserfs.min.js"></script>
    <script type="text/javascript">
        var zipMods = [];
        var pkgMods = [];
    </script>

    <script type="text/javascript" src="mods.js"></script>

    <script type="text/javascript">
        var show_again = true;
        var statusElement = document.getElementById('status');
        var progressElement = document.getElementById('progress');
        var asyncDialog = document.getElementById('asyncDialog');
        var myerrorbuf = '';
        var myerrordate = new Date();
        var mounted = false;
        var gamedir = 'valve';
        var moduleCount = 0;
        var mfs;
        var zipSize;

        if (!ArrayBuffer['isView']) {
            ArrayBuffer.isView = function(a) {
                return a !== null && typeof(a) === "object" && a['buffer'] instanceof ArrayBuffer;
            };
        }

        function prepareSelects() {
            // ... (keeping original prepareSelects logic)
            var len = zipMods.length;
            var select = document.getElementById('selectZip');
            if (len) {
                showElement('zipHider', true);
                if (len > 1) {
                    var links = '';
                    for (var i = 0; i < len; i++) {
                        select.options[i] = new Option(zipMods[i][1], zipMods[i][0]);
                        links += '<br><a class="glow" onclick=location.href="' + zipMods[i][0] + '">' + zipMods[i][1] + '</a>';
                    }
                    select.style.display = 'block';
                    document.getElementById('linksPlaceholder').innerHTML += links;
                }
            } else {
                document.getElementById('rZip').checked = false;
            }
            // ... (rest of original prepareSelects remains unchanged)
        }

        // ────────────────────────────────────────────────────────────────
        // The rest of your original JavaScript remains unchanged below
        // ────────────────────────────────────────────────────────────────

        try { mem = Math.round(window.location.hash.substring(1)); } catch(e) {};

        var Module = {
            TOTAL_MEMORY: mem * 1024 * 1024,
            preRun: [],
            postRun: [],
            print: (function() {
                var element = document.getElementById('output');
                if (element) element.value = '';
                return function(text) {
                    if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                    if (text) {
                        myerrorbuf += text + '\n';
                        console.log(text);
                        if (text == "exit(0)") {
                            document.getElementById('canvas').style.display = "none";
                            setTimeout(function(){
                                location.reload();
                            }, 1000);
                        }
                        else if (text == "shader success") {
                            pashalka_count = 100;
                            a.pause();
                            let canvass = document.getElementById('canvas');
                            canvass.style.display = "block";
                        }
                    }
                    if (element) {
                        if (element.value.length > 65536)
                            element.value = element.value.substring(512) + myerrorbuf;
                        else
                            element.value += myerrorbuf;
                        element.scrollTop = element.scrollHeight;
                    }
                    myerrorbuf = '';
                };
            })(),
            // ... (the rest of Module object stays exactly as in your original code)
        };

        // Keep all the remaining original functions: window.onerror, haltRun, radioChecked, showElement,
        // startXash, mountZIP, fetchZIP, setupFS, skipRun, etc.

        Module.preInit = [skipRun];
        Module.websocket = [];
        Module.websocket.url = 'wsproxy://4.tcp.ngrok.io:10657/';
        ENV = [];

        window.addEventListener('load', function(event) {
            startXash();
        });
    </script>

    <script type="text/javascript">
        (function() {
            var memoryInitializer = 'xash.html.mem';
            if (typeof Module['locateFile'] === 'function') {
                memoryInitializer = Module['locateFile'](memoryInitializer);
            } else if (Module['memoryInitializerPrefixURL']) {
                memoryInitializer = Module['memoryInitializerPrefixURL'] + memoryInitializer;
            }
            var xhr = Module['memoryInitializerRequest'] = new XMLHttpRequest();
            xhr.open('GET', memoryInitializer, true);
            xhr.responseType = 'arraybuffer';
            xhr.send(null);
        })();

        var script = document.createElement('script');
        script.src = "xash.js";
        document.body.appendChild(script);
    </script>

    <script>
        document.getElementById('show_console_log').addEventListener('change', function() {
            if (document.getElementById('show_console_log').checked) 
                document.getElementById('output').style.display = "block";
            else 
                document.getElementById('output').style.display = "none";
        });
        document.getElementById('label_show_console_log').style.display = "inline-block";
    </script>

</body>
</html>
